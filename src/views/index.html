<!DOCTYPE html>
<html lang="{{lang}}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="light dark">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Drop5 â€” {{code}}</title>
    <link rel="icon" href="{{base_url}}/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="{{base_url}}/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="{{base_url}}/style.css">
    <script>
        (function () {
            const getCookie = (name) => {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            };
            const savedTheme = getCookie('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else {
                const hour = new Date().getHours();
                const isNight = hour >= 20 || hour < 7;
                document.documentElement.setAttribute('data-theme', isNight ? 'dark' : 'light');
            }
        })();
    </script>
    % if umami_id:
    <script defer src="{{umami_url}}/script.js" data-website-id="{{umami_id}}"></script>
    % end
</head>

<body>
    <!-- Waiting Overlay (Initially Hidden) -->
    <div id="waitingOverlay" class="waiting-overlay" style="display: none;">
        <div class="waiting-icon">ğŸ”’</div>
        <div class="waiting-title">{{translations.waiting_host_approval}}</div>
        <div class="waiting-desc">
            {{!translations.waiting_approval_desc}}
        </div>
    </div>

    <!-- Approval Modal (Initially Hidden) -->
    <div id="approvalModal" class="approval-modal">
        <div class="approval-header">
            <span>ğŸ“±</span> {{translations.new_device_request}}
        </div>
        <div style="color: var(--text-secondary); font-size: 0.9rem;">
            {{translations.new_device_confirm}}
        </div>
        <div id="approvalDeviceInfo"
            style="font-size: 0.75rem; color: var(--text-secondary); opacity: 0.8; text-align: center; margin-top: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
        </div>
        <div class="approval-actions">
            <button class="btn-reject" onclick="handleApprovalDecision('reject')">{{translations.reject}}</button>
            <button class="btn-approve" onclick="handleApprovalDecision('approve')">{{translations.approve}}</button>
        </div>
    </div>

    <div class="header">
        <div class="brand">Drop5</div>
        <div class="header-right">
            <div class="session-code" id="sessionCode" onclick="copyURL()" title="{{translations.copy_link}}"
                tabindex="0" role="button">
                {{code}} ğŸ”—
            </div>
            <div class="header-actions">
                <button class="header-icon-btn" onclick="toggleLanguage()" title="{{translations.lang_toggle}}">
                    <span>ğŸŒ</span>
                </button>
                <a href="https://github.com/yoonbae81/drop5" class="header-icon-btn github-link" target="_blank"
                    rel="noopener noreferrer" title="GitHub">
                    <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                        </path>
                    </svg>
                </a>
                <button class="header-icon-btn" id="themeToggle" title="{{translations.theme_toggle}}">
                    <span id="themeIcon">ğŸŒ™</span>
                </button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Upload Zone (30%) -->
        <div class="upload-section">
            <div class="drop-zone" id="dropZone" tabindex="0" role="button" aria-label="{{translations.upload_text}}">
                <div class="upload-icon">â˜ï¸</div>
                <div class="upload-text">{{translations.upload_text}}</div>
                <input type="file" id="fileInput" multiple style="display: none">
                <button class="text-input-btn" id="textInputBtn" title="{{translations.text_input}}"
                    onclick="openTextModal(event)"> ğŸ“
                </button>
            </div>


            <div class="progress-overlay" id="progressOverlay">
                <div class="spinner"></div>
                <div id="progressText" style="margin-top:1rem;font-weight:600;color:var(--text-primary)">
                    {{translations.uploading}}</div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>

        <!-- File List (70%) -->
        <div class="file-list-section">
            <button class="delete-all-btn" id="deleteAllBtn" title="{{translations.delete_all_files}}"
                onclick="deleteAllFiles()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
            </button>
            <div id="fileListContent">
                <div id="fileItems">
                    % if files:
                    <div class="file-grid">
                        % for file in files:
                        <a href="{{base_url}}/{{code}}/download/{{file['name']}}" class="file-card" download
                            data-remaining="{{file['remaining_min'] * 60 + int(file['remaining_sec'])}}">
                            <div class="file-icon">ğŸ“„</div>
                            <div class="file-name" title="{{file['name']}}">{{file['name']}}</div>
                            <div class="file-meta">
                                <span style="white-space: nowrap">{{ format_size(file['size']) }}</span>
                                <div class="time-badge">
                                    â±ï¸ <span class="countdown-timer">{{file['remaining_min']}}m
                                        {{file['remaining_sec']}}s</span>
                                </div>
                            </div>
                        </a>
                        % end
                    </div>
                    % else:
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div class="upload-text">{{translations.no_files_yet}}</div>
                    </div>
                    % end
                </div>
            </div>
            <div class="footer-container mobile-footer" id="footerBlockMobile">
                <span class="disclaimer">{{translations.disclaimer}}</span>
                % if contact_email:
                <a href="mailto:{{contact_email}}" class="footer-link">
                    <span class="footer-icon">âœ‰ï¸</span>
                </a>
                % end
                % if company_name:
                <span class="copyright">Â© 2026 {{company_name}}</span>
                % end
            </div>
        </div>
    </div>

    <div class="footer-container desktop-footer" id="footerBlockDesktop">
        <span class="disclaimer">{{translations.disclaimer}}</span>
        % if contact_email:
        <a href="mailto:{{contact_email}}" class="footer-link">
            <span class="footer-icon">âœ‰ï¸</span>
        </a>
        % end
        % if company_name:
        <span class="copyright">Â© 2026 {{company_name}}</span>
        % end
    </div>

    <div class="toast" id="toast">{{translations.link_copied}}</div>

    <div class="modal-overlay" id="textModal" onclick="handleOverlayClick(event)">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ {{translations.text_input_modal_title}}</div>
                <button class="close-modal" onclick="closeTextModal()">&times;</button>
            </div>
            <textarea id="textInputTextArea" class="text-textarea"
                placeholder="{{translations.upload_hint}}"></textarea>
            <button class="save-text-btn" onclick="saveText()">{{translations.upload_text}}</button>
        </div>
    </div>

    <script src="{{base_url}}/app.js?code={{code}}"></script>
</body>